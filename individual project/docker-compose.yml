version: "3.3"
services:
    mysql:
        image: mariadb:latest
        environment:
            MYSQL_ROOT_PASSWORD: MyDBRoot123
            MYSQL_DATABASE: cloud_computing
            MYSQL_USER: php
            MYSQL_PASSWORD: php
        networks:
            - mynet
    myphp:
        image: runxing07/myrepo:latest
        depends_on:
            - mysql
        ports:
            - "9000:9000"
        volumes:
            - ./src:/var/www/html
        deploy:
            placement:
                constraints:
                    - node.role == manager
        networks:
            - mynet
    mynginx:
        image: nginx:latest
        depends_on:
            - myphp
        ports:
            - "8080:80"
        deploy:
            mode: replicated
            replicas: 2
            placement:
                constraints:
                    - node.role == manager
        volumes:
            - ./src/nginx.ini:/etc/nginx/conf.d/default.conf
            - ./src:/var/www/html
        networks:
            - mynet
    visualizer:
            image: dockersamples/visualizer:latest
            ports:
              - 80:80
            volumes:
              - /var/run/docker.sock:/var/run/docker.sock
            deploy:
              placement:
                constraints: [node.role ==  manager]
    phpMyAdmin:
        image: phpmyadmin
        environment:
            PMA_HOST: mysql
        ports:
            - "8082:80"
        networks:
            - mynet
volumes:
    src:
networks:
    mynet:
        driver: overlay
